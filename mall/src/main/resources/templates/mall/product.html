<input type="hidden" id="productId" th:value="${productId}"/>

<!--<div class="categoryPictureInProductPageDiv">
    <input type="hidden" id="produc" value="" />
    <img id="picture" class="productPictureInProductPage" src="" />
</div>-->

<div class="productPageDiv">
    <div th:replace="mall/product-imgAndInfo.html"></div>

    <div class="productDetailDiv" role="tabpanel" data-example-id="togglable-tabs">
        <ul id="myTab" class="nav nav-tabs bar_tabs" role="tablist">
            <li role="presentation" class="active">
                <a href="#productDetailDiv" id="home-tab" role="tab" data-toggle="tab"
                   aria-expanded="true">商品详情</a>
            </li>
            <li role="presentation" class="">
                <a href="#productReviewDiv" role="tab" id="profile-tab" data-toggle="tab"
                   aria-expanded="false">累计评价<span class="productReviewTopReviewLinkNumber"></span></a>
            </li>
        </ul>
        <div id="myTabContent" class="tab-content">
            <div th:replace="mall/product-comments.html"></div>
            <div th:replace="mall/product-detail.html"></div>
        </div>
    </div>
</div>

<script type="text/javascript">
    $(function(){
        initProductInfo();

        $(".addCartButton").bind("click", function() {
            addCartEvent();
        });
        $(".buyButton").bind("click", function() {
            buyEvent();
        });
    });

    // 初始化产品信息
    function initProductInfo() {
        var productId = $("#productId").val();
        $.ajax({
            url : "/mall/product/" + productId,
            type : "get",
            contentType: "application/json",
            //data : JSON.stringify(searchVo),
            success : function (data) {
                // 初始化产品信息
                $("#categoryId").val(data.categoryId);
                $(".productTitle").html(data.productName);
                $(".bigImg").attr('src',data.pictureUrl)
                $(".promotionPrice").html(data.productPrice);
                $("[name='number']").html(data.productNum);

                //初始化数量框事件
                initCountEvent(data.number);
                // 初始化数量框事件
                function initCountEvent(stock) {
                    $(".productNumberSetting").keyup(function() {
                        var num = $(".productNumberSetting").val();
                        num = parseInt(num);
                        if(isNaN(num))
                            num = 1;
                        if(num <= 0)
                            num = 1;
                        if(num > stock)
                            num = stock;
                        $(".productNumberSetting").val(num);
                    });
                    $(".increaseNumber").click(function(){
                        var num= $(".productNumberSetting").val();
                        num++;
                        if(num > stock)
                            num = stock;
                        $(".productNumberSetting").val(num);
                    });
                    $(".decreaseNumber").click(function(){
                        var num= $(".productNumberSetting").val();
                        --num;
                        if(num<=0)
                            num=1;
                        $(".productNumberSetting").val(num);
                    });
                }
            },
            error : function (data) {
                layer.msg(data.responseText, {icon: 0});
            }
        });
    }


</script>
